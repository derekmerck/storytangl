kind: pipeline
type: docker
name: default

steps:

- name: test
  image: python
  commands:
    - pip install poetry
    - poetry install
    - poetry run python -c "import tangl.config; tangl.config.show_settings()"
    - poetry run pytest -W ignore::DeprecationWarning

    # todo: re-add when cli is working
    # confirm the setup alias works
    # - poetry run tangl-cli get_status quit
    # todo: re-add when server is working
    # should confirm the alias works, but won't exit without wrapper
    # - poetry run tangl-serve

    # build takes advantage of existing environment
    - poetry build
    - cp dist/*.whl /drone/src/

- name: test-install
  image: python:3.11
  commands:
    - pip install /drone/src/*.whl
    - python -c "import tangl; print(tangl.__version__)"

# todo: update the docker image if it passes test stage
#- name: docker
